AMI_ID="ami-0d421d84814b7d51c"
INSTANCE_TYPE="t3.small"
SECURITY_GROUP_ID="sg-0bf7d88ad53a5d530"
SUBNET_ID="subnet-0c23abf914c7219f6"
INSTANCE_NAME=$1
COUNT=$2
USER_DATA=$(cat <<EOF
#!/bin/bash
# Actualiza el sistema
yum update -y
# Instala los paquetes necesarios
yum install -y docker
# Inicia el servicio de docker
systemctl start docker
# Habilita el servicio de docker para que inicie en el arranque
systemctl enable docker
# Instalamos docker compose
sudo curl -L https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
git clone https://github.com/celia003/docker-app.git
cd docker-app && docker-compose up -d
EOF
)


INSTANCE_ID=$(aws ec2 run-instances --image-id $AMI_ID --count $COUNT --associate-public-ip-address --instance-type $INSTANCE_TYPE --security-group-ids $SECURITY_GROUP_ID --subnet-id $SUBNET_ID --tag-specifications "ResourceType=instance,Tags=[{Key=Name,Value=$INSTANCE_NAME}]" --user-data "$USER_DATA" --query "Instances[0].InstanceId" --output text)
echo "Instance ID: $INSTANCE_ID"
echo "$INSTANCE_NAME created succesfully."
